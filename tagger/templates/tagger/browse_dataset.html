{% extends "tagger/base.html" %}
{% block content %}
  <!-- Header Section -->
  <div class="row mb-3">
    <div class="col-sm-8">
      <h1 class="h5">Website dataset</h1>
    </div>
    <div class="col-sm-4">
      <div class="input-group input-group-sm">
        <input type="text"
                name="q"
                id="q"
                placeholder="Search..."
                class="form-control"
                required/>
        <span class="input-group-text">
          <i class="fa-solid fa-search"></i>
        </span>
      </div>
    </div>
  </div>
  <!-- Table Section -->
  <div class="table-responsive border-top pt-3 mb-3">
    <table class="table table-sm table-striped">
      <thead>
        <tr>
          <th>ID</th>
          <th>Lang</th>
          <th>Sentence</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for annotated_sentence in page_obj %}
          <tr>
            <td>{{ annotated_sentence.id }}</td>
            <td>{{ annotated_sentence.language }}</td>
            <td>{{ annotated_sentence.raw }}</td>
            <td>
              <!-- View Button -->
              <button type="button" class="btn btn-sm btn-light view-annotation-button"
                data-pos-id="{{ annotated_sentence.id }}"
                data-bs-toggle="modal" data-bs-target="#viewAnnotationModal">
                <i class="fa-solid fa-eye"></i>
              </button>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="4" class="text-center">No items yet.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <!-- Pagination Information Section -->
  <div class="row pt-3 border-top">
    <div class="col-sm-6">
      Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
    </div>
    <div class="col-sm-6 text-end">
      <div class="btn-group" role="group" aria-label="Pagination buttons">
        {% if page_obj.has_previous %}
          <a href="?page=1" class="btn btn-light">
            <i class="fa-solid fa-angles-left"></i>
          </a>
          <a href="?page={{ page_obj.previous_page_number }}" class="btn btn-light">
            <i class="fa-solid fa-angle-left"></i>
          </a>
        {% endif %}
        {% if page_obj.has_next %}
          <a href="?page={{ page_obj.next_page_number }}" class="btn btn-light">
            <i class="fa-solid fa-angle-right"></i>
          </a>
          <a href="?page={{ page_obj.paginator.num_pages }}" class="btn btn-light">
            <i class="fa-solid fa-angles-right"></i>
          </a>
        {% endif %}
      </div>
    </div>
  </div>
  <!-- View Annotation Modal -->
  <div class="modal fade" id="viewAnnotationModal"
    tabindex="-1" aria-labelledby="viewAnnotationModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="viewAnnotationModalLabel">Annotated Sentence</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-sm btn-outline-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
{% endblock content %}

{% block page_js %}
  <script>
    const viewButtons = document.getElementsByClassName("view-annotation-button");
    if(viewButtons) {
      for(let viewButton of viewButtons) {
        viewButton.addEventListener('click', (event) => {
          const id = viewButton.dataset.posId;
          let request = new XMLHttpRequest();
          request.onload = () => {
            let modalBody = document.querySelector("#viewAnnotationModal .modal-body");
            let annotated_tokens = JSON.parse(request.response).annotation;
            // Render the tags
            modalBody.replaceChildren();
            for(let annotated_token of annotated_tokens) {
              let tokenElement = document.createElement("span");
              tokenElement.className = `badge bg-pos-${annotated_token.tag.toLowerCase()} me-2 mb-2`;
              tokenElement.appendChild(document.createTextNode(
                `${annotated_token.token} | ${annotated_token.tag}`));
              modalBody.appendChild(tokenElement);
            }
          };
          // TODO: Find a solution that is not hardcoding the URL
          request.open("GET", `/annotated-sentence/${id}/`);
          request.send();
        });
      }
    }
  </script>
{% endblock page_js %}